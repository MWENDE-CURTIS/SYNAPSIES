<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SYNAPSIES - Campus Social MVP</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap">
  <style>
    :root {
      --brown-dark: #2d1a13;
      --brown: #4e2e1e;
      --brown-light: #7c4a2d;
      --brown-card: #3a2117;
      --brown-accent: #ffde76;
      --brown-accent2: #ffe9a7;
      --brown-border: #6d3b1e;
      --text-main: #f7f3ef;
      --text-muted: #ffe9a7;
      --badge-leader: #b983ff;
      --badge-faculty: #ffb84c;
      --badge-student: #ff7f50;
      --badge-campus: #ffde76;
      --shadow: 0 2px 12px rgba(80, 40, 10, 0.18);
    }
    body {
      background: var(--brown-dark);
      color: var(--text-main);
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .app-container {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--brown);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 18px 10px 18px;
      border-bottom: 1px solid var(--brown-border);
      background: var(--brown-dark);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .topbar .profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: var(--brown-accent);
      color: #4e2e1e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1em;
      border: 2px solid var(--brown-accent2);
    }
    .username {
      font-weight: 600;
      font-size: 1.1em;
      color: var(--text-main);
    }
    .dropdown-arrow {
      font-size: 1.2em;
      color: var(--brown-accent);
      margin-left: 2px;
    }
    .topbar .menu-btn {
      background: none;
      border: none;
      color: var(--brown-accent);
      font-size: 1.5em;
      cursor: pointer;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      background: var(--brown-dark);
      border-bottom: 1px solid var(--brown-border);
    }
    .tab-btn {
      flex: 1;
      padding: 12px 0;
      text-align: center;
      color: var(--brown-accent2);
      font-size: 1.1em;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
      position: relative;
    }
    .tab-btn.active {
      color: var(--brown-accent);
      font-weight: 600;
    }
    .tab-btn.active::after {
      content: '';
      display: block;
      margin: 0 auto;
      margin-top: 4px;
      width: 28px;
      height: 3px;
      border-radius: 2px;
      background: var(--brown-accent);
    }
    .feed {
      flex: 1;
      overflow-y: auto;
      padding: 0 0 70px 0;
      background: var(--brown);
    }
    .post-card {
      background: var(--brown-card);
      border-radius: 14px;
      margin: 18px 16px;
      padding: 16px 14px 10px 14px;
      box-shadow: var(--shadow);
      position: relative;
      transition: box-shadow 0.2s;
    }
    .post-card:hover {
      box-shadow: 0 4px 24px rgba(255,222,118,0.13);
    }
    .post-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .post-user {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .badge {
      border-radius: 8px;
      padding: 2px 8px;
      font-size: 0.85em;
      margin-left: 4px;
      font-weight: 500;
      vertical-align: middle;
    }
    .badge-leader { background: var(--badge-leader); color: #fff; }
    .badge-faculty { background: var(--badge-faculty); color: #4e2e1e; }
    .badge-student { background: var(--badge-student); color: #fff; }
    .badge-campus { background: var(--badge-campus); color: #4e2e1e; }
    .post-content {
      margin-bottom: 10px;
      color: #ffe9a7;
      font-size: 1.08em;
      line-height: 1.5;
      word-break: break-word;
    }
    .post-footer {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 1em;
      color: var(--brown-accent2);
      margin-top: 4px;
    }
    .post-footer button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 1em;
      padding: 2px 6px;
      border-radius: 6px;
      transition: background 0.15s;
    }
    .post-footer button:hover {
      background: var(--brown-border);
      color: var(--brown-accent);
    }
    .post-footer .liked {
      color: var(--brown-accent);
      font-weight: bold;
    }
    .comment-section {
      margin-top: 10px;
      background: #3a2117;
      border-radius: 8px;
      padding: 10px 8px;
    }
    .comment {
      margin-bottom: 8px;
      font-size: 0.98em;
      color: var(--brown-accent2);
    }
    .comment .username {
      color: var(--brown-accent);
      font-weight: 600;
      margin-right: 6px;
    }
    .comment-form {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }
    .comment-form input, .comment-form textarea {
      flex: 1;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 1em;
      background: #4e2e1e;
      color: #ffe9a7;
    }
    .comment-form button {
      background: var(--brown-accent);
      color: #4e2e1e;
      border: none;
      border-radius: 6px;
      padding: 6px 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
    }
    .comment-form button:hover {
      background: var(--brown-accent2);
    }
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(46, 20, 10, 0.92);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal {
      background: var(--brown-card);
      color: var(--text-main);
      border-radius: 14px;
      padding: 0;
      box-shadow: var(--shadow);
      min-width: 280px;
      max-width: 95vw;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .modal-header {
      background: var(--brown-dark);
      color: var(--brown-accent);
      padding: 18px 22px 12px 22px;
      font-size: 1.2em;
      font-weight: 600;
      border-bottom: 1px solid var(--brown-border);
      text-align: left;
      position: relative;
    }
    .modal-content {
      padding: 18px 22px 18px 22px;
      text-align: left;
    }
    .modal input, .modal select, .modal textarea {
      margin-top: 10px;
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      font-size: 1em;
      background: #4e2e1e;
      color: #ffe9a7;
      margin-bottom: 8px;
    }
    .modal button {
      background: var(--brown-accent);
      color: #4e2e1e;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
      border: none;
      border-radius: 8px;
      padding: 10px 0;
      width: 100%;
      font-size: 1em;
      transition: background 0.15s;
    }
    .modal button:hover {
      background: var(--brown-accent2);
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 16px;
      font-size: 1.3em;
      color: var(--brown-accent);
      background: none;
      border: none;
      cursor: pointer;
    }
    .auth-tabs {
      display: flex;
      margin-bottom: 18px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--brown-border);
    }
    .auth-tab {
      flex: 1;
      padding: 10px 0;
      background: var(--brown-card);
      color: var(--brown-accent2);
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 1em;
      transition: background 0.15s, color 0.15s;
    }
    .auth-tab.active {
      background: var(--brown-accent);
      color: #4e2e1e;
    }
    .library-list, .chat-list {
      margin: 18px 12px;
      padding: 0;
      list-style: none;
    }
    .library-item, .chat-item {
      background: var(--brown-card);
      border-radius: 10px;
      margin-bottom: 14px;
      padding: 14px 12px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .library-item:hover, .chat-item:hover {
      background: var(--brown-border);
    }
    .library-icon, .chat-avatar {
      width: 38px;
      height: 38px;
      border-radius: 8px;
      background: var(--brown-accent);
      color: #4e2e1e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
    }
    .library-info, .chat-info {
      flex: 1;
    }
    .library-title {
      font-weight: 600;
      color: var(--brown-accent);
      margin-bottom: 2px;
    }
    .library-desc {
      font-size: 0.98em;
      color: var(--brown-accent2);
    }
    .chat-username {
      font-weight: 600;
      color: var(--brown-accent);
      margin-bottom: 2px;
    }
    .chat-preview {
      font-size: 0.98em;
      color: var(--brown-accent2);
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--brown-dark);
      border-top: 1px solid var(--brown-border);
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 62px;
      z-index: 100;
    }
    .nav-btn {
      background: none;
      border: none;
      color: var(--brown-accent2);
      font-size: 1.5em;
      cursor: pointer;
      flex: 1;
      padding: 0;
      transition: color 0.18s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    .nav-btn.active {
      color: var(--brown-accent);
    }
    .nav-btn.post-btn {
      font-size: 2.1em;
      color: var(--brown-accent);
      background: var(--brown-card);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      margin-top: -18px;
      box-shadow: 0 2px 12px rgba(255,222,118,0.18);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @media (max-width: 600px) {
      .app-container { border-radius: 0; }
      .post-card, .library-item, .chat-item { margin-left: 4px; margin-right: 4px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="topbar">
      <div class="profile" onclick="showProfileMenu()">
        <div class="avatar" id="main-avatar">U</div>
        <span class="username" id="main-username">username</span>
        <span class="dropdown-arrow">&#9660;</span>
      </div>
      <button class="menu-btn" onclick="showMainMenu()">
        &#9776;
      </button>
    </div>
    <div class="tabs">
      <button class="tab-btn active" id="tab-hub" onclick="switchTab('hub')">Hub</button>
      <button class="tab-btn" id="tab-campus" onclick="switchTab('campus')">In_Campus</button>
      <button class="tab-btn" id="tab-library" onclick="switchTab('library')">Library</button>
      <button class="tab-btn" id="tab-chat" onclick="switchTab('chat')">Chat</button>
    </div>
    <div class="feed" id="feed"></div>
    <div class="bottom-nav">
      <button class="nav-btn active" id="nav-hub" onclick="switchTab('hub')">
        <span>&#8962;</span>
        <span style="font-size:0.7em;">Home</span>
      </button>
      <button class="nav-btn" id="nav-campus" onclick="switchTab('campus')">
        <span>&#127979;</span>
        <span style="font-size:0.7em;">Campus</span>
      </button>
      <button class="nav-btn post-btn" onclick="promptSignInOrPost()">
        +
      </button>
      <button class="nav-btn" id="nav-library" onclick="switchTab('library')">
        <span>&#128218;</span>
        <span style="font-size:0.7em;">Library</span>
      </button>
      <button class="nav-btn" id="nav-chat" onclick="switchTab('chat')">
        <span>&#128172;</span>
        <span style="font-size:0.7em;">Chat</span>
      </button>
    </div>
  </div>

  <!-- Modals and Menus -->
  <div id="modal-root"></div>

  <!-- Firebase App (core) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>



  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDAQ2ne6N9hTo3dBPPvdWcRRwJjZP_SQ5E",
      authDomain: "synapsies-ef9fd.firebaseapp.com",
      projectId: "synapsies-ef9fd",
      storageBucket: "synapsies-ef9fd.appspot.com",
      messagingSenderId: "278327466728",
      appId: "1:278327466728:web:ef06cca39afa3c0487875d",
      measurementId: "G-1465WZ865V"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Get references to Auth and Firestore
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <script>
    // Demo user and data
    let user = null; // {username, avatar, campus, role}
    const demoUser = {username: "sarah_med", avatar: "S", campus: "University of Nairobi", role: "student"};
    const demoCampus = [
      {name: "University of Nairobi", badge: "UoN"},
      {name: "Kenyatta University", badge: "KU"},
      {name: "Strathmore University", badge: "SU"},
      {name: "USIU", badge: "USIU"},
      {name: "Jomo Kenyatta University", badge: "JKU"}
    ];
    const demoPosts = [
      {
        id: 1,
        username: "sarah_med",
        avatar: "S",
        campus: "University of Nairobi",
        role: "student",
        content: "Anyone have notes for Organic Chemistry? The midterm is coming up and I'm struggling with reaction mechanisms üòÖ",
        likes: 15,
        liked: false,
        comments: [
          {username: "math_whiz", avatar: "M", text: "I can share my notes!"},
          {username: "prof_kimani", avatar: "P", text: "Check the library section for past papers."}
        ],
        time: "2h"
      },
      {
        id: 2,
        username: "prof_kimani",
        avatar: "P",
        campus: "Kenyatta University",
        role: "faculty",
        content: "Reminder: Research proposal submissions are due this Friday. Make sure to follow the APA format guidelines we discussed in class.",
        likes: 42,
        liked: false,
        comments: [
          {username: "sarah_med", avatar: "S", text: "Thanks for the reminder!"},
        ],
        time: "4h"
      },
      {
        id: 3,
        username: "student_leader_jane",
        avatar: "J",
        campus: "USIU",
        role: "leader",
        content: "Student council meeting tomorrow at 2 PM in the main hall. We'll be discussing the new cafeteria menu and library hours extension.",
        likes: 67,
        liked: false,
        comments: [],
        time: "8h"
      }
    ];
    const demoLibrary = [
      {title: "Calculus I - Past Papers", desc: "2020-2023, with solutions", icon: "üìÑ"},
      {title: "Data Structures & Algorithms Notes", desc: "All major algorithms and data structures", icon: "üìö"},
      {title: "Organic Chemistry Lab Manual", desc: "Step-by-step procedures for all experiments", icon: "üß™"}
    ];
    const demoChats = [
      {username: "math_whiz", avatar: "M", preview: "Thanks for the notes!"},
      {username: "tech_guru_ke", avatar: "T", preview: "Let's meet for the project."},
      {username: "student_leader_jane", avatar: "J", preview: "See you at the council meeting."}
    ];

    // Tab state
    let currentTab = "hub";

    // Initial render
    document.addEventListener("DOMContentLoaded", () => {
      renderUser();
      loadPosts();
    });

    function renderUser() {
      const username = user ? user.username : "username";
      const avatar = user ? user.avatar : "U";
      document.getElementById("main-username").textContent = username;
      document.getElementById("main-avatar").textContent = avatar;
    }

    function switchTab(tab) {
      currentTab = tab;
      // Update tab and nav active states
      ["hub", "campus", "library", "chat"].forEach(t => {
        document.getElementById("tab-" + t).classList.toggle("active", t === tab);
        document.getElementById("nav-" + t)?.classList.toggle("active", t === tab);
      });
      renderTab();
    }

    function renderTab() {
      const feed = document.getElementById("feed");
      feed.innerHTML = "";
      if (currentTab === "hub") {
        renderFeed(feed, demoPosts, "Hub - All Universities");
      } else if (currentTab === "campus") {
        const campusPosts = demoPosts.filter(p => user ? p.campus === user.campus : p.campus === "University of Nairobi");
        renderFeed(feed, campusPosts, "In_Campus - Local Forum");
      } else if (currentTab === "library") {
        renderLibrary(feed);
      } else if (currentTab === "chat") {
        renderChat(feed);
      }
    }

    function renderFeed(container, posts, title) {
      const titleEl = document.createElement("h2");
      titleEl.textContent = title;
      titleEl.style.margin = "18px 0 8px 18px";
      titleEl.style.fontWeight = "600";
      titleEl.style.color = "var(--brown-accent)";
      container.appendChild(titleEl);

      posts.forEach(post => {
        const card = document.createElement("div");
        card.className = "post-card";

        // Header
        const header = document.createElement("div");
        header.className = "post-header";
        const userDiv = document.createElement("div");
        userDiv.className = "post-user";
        userDiv.onclick = () => showProfile(post.username);
        const avatar = document.createElement("div");
        avatar.className = "avatar";
        avatar.textContent = post.avatar;
        const uname = document.createElement("span");
        uname.className = "username";
        uname.textContent = post.username;
        const campusBadge = document.createElement("span");
        campusBadge.className = "badge badge-campus";
        campusBadge.textContent = demoCampus.find(c => c.name === post.campus)?.badge || post.campus;
        const roleBadge = document.createElement("span");
        roleBadge.className = "badge " + (
          post.role === "leader" ? "badge-leader" :
          post.role === "faculty" ? "badge-faculty" : "badge-student"
        );
        roleBadge.textContent = post.role;
        userDiv.append(avatar, uname, campusBadge, roleBadge);

        // 3-dot menu
        const menuBtn = document.createElement("button");
        menuBtn.className = "menu-btn";
        menuBtn.innerHTML = "&#8942;";
        menuBtn.onclick = (e) => { e.stopPropagation(); showPostMenu(post); };

        header.append(userDiv, menuBtn);

        // Content
        const content = document.createElement("div");
        content.className = "post-content";
        content.textContent = post.content;

        // Footer
        const footer = document.createElement("div");
        footer.className = "post-footer";

        // Like
        const likeBtn = document.createElement("button");
        likeBtn.innerHTML = `&#10084; <span>${post.likes}</span>`;
        if (post.liked) likeBtn.classList.add("liked");
        likeBtn.onclick = () => {
          if (!user) return promptSignIn();
          post.liked = !post.liked;
          post.likes += post.liked ? 1 : -1;
          renderTab();
        };
        footer.appendChild(likeBtn);

        // Comment
        const commentBtn = document.createElement("button");
        commentBtn.innerHTML = `üí¨ <span>${post.comments.length}</span>`;
        commentBtn.onclick = () => showComments(post);
        footer.appendChild(commentBtn);

        // Repost
        const repostBtn = document.createElement("button");
        repostBtn.innerHTML = `üîÅ <span>${Math.floor(post.likes/3)}</span>`;
        repostBtn.onclick = () => alert("Repost feature coming soon!");
        footer.appendChild(repostBtn);

        // Send
        const sendBtn = document.createElement("button");
        sendBtn.innerHTML = `&#10148;`;
        sendBtn.onclick = () => alert("Send to DM coming soon!");
        footer.appendChild(sendBtn);

        // Save
        const saveBtn = document.createElement("button");
        saveBtn.innerHTML = `&#9737;`;
        saveBtn.onclick = () => alert("Save post coming soon!");
        footer.appendChild(saveBtn);

        // Time
        const time = document.createElement("span");
        time.style.marginLeft = "auto";
        time.textContent = post.time + " ago";
        footer.appendChild(time);

        card.append(header, content, footer);
        container.appendChild(card);
      });
    }

    function renderLibrary(container) {
      const titleEl = document.createElement("h2");
      titleEl.textContent = "Library Hub";
      titleEl.style.margin = "18px 0 8px 18px";
      titleEl.style.fontWeight = "600";
      titleEl.style.color = "var(--brown-accent)";
      container.appendChild(titleEl);

      const list = document.createElement("ul");
      list.className = "library-list";
      demoLibrary.forEach(item => {
        const li = document.createElement("li");
        li.className = "library-item";
        li.onclick = () => promptSignInOrDownload();
        const icon = document.createElement("div");
        icon.className = "library-icon";
        icon.textContent = item.icon;
        const info = document.createElement("div");
        info.className = "library-info";
        const title = document.createElement("div");
        title.className = "library-title";
        title.textContent = item.title;
        const desc = document.createElement("div");
        desc.className = "library-desc";
        desc.textContent = item.desc;
        info.append(title, desc);
        li.append(icon, info);
        list.appendChild(li);
      });
      container.appendChild(list);
    }

    function renderChat(container) {
      const titleEl = document.createElement("h2");
      titleEl.textContent = "Chats";
      titleEl.style.margin = "18px 0 8px 18px";
      titleEl.style.fontWeight = "600";
      titleEl.style.color = "var(--brown-accent)";
      container.appendChild(titleEl);

      const list = document.createElement("ul");
      list.className = "chat-list";
      demoChats.forEach(chat => {
        const li = document.createElement("li");
        li.className = "chat-item";
        li.onclick = () => alert("DMs coming soon!");
        const avatar = document.createElement("div");
        avatar.className = "chat-avatar";
        avatar.textContent = chat.avatar;
        const info = document.createElement("div");
        info.className = "chat-info";
        const uname = document.createElement("div");
        uname.className = "chat-username";
        uname.textContent = chat.username;
        const preview = document.createElement("div");
        preview.className = "chat-preview";
        preview.textContent = chat.preview;
        info.append(uname, preview);
        li.append(avatar, info);
        list.appendChild(li);
      });
      container.appendChild(list);
    }

    function showComments(post) {
      showModal(`
        <div class="modal-header">Comments</div>
        <div class="modal-content">
          <div style="max-height:180px;overflow-y:auto;text-align:left;">
            ${post.comments.map(c => `
              <div class="comment">
                <span class="username">${c.username}</span>
                ${c.text}
              </div>
            `).join("")}
          </div>
          <form class="comment-form" onsubmit="return false;">
            <input type="text" id="comment-input" placeholder="Add a comment..." autocomplete="off"/>
            <button type="submit">Post</button>
          </form>
        </div>
      `, modal => {
        modal.querySelector("form").onsubmit = () => {
          if (!user) { promptSignIn(); return false; }
          const val = modal.querySelector("#comment-input").value.trim();
          if (val) {
            post.comments.push({username: user.username, avatar: user.avatar, text: val});
            renderTab();
            closeModal();
          }
          return false;
        };
      });
    }

    function promptSignIn() {
      showAuthModal();
    }

    function promptSignInOrPost() {
      if (!user) return promptSignIn();
      showModal(`
        <div class="modal-header">Create a Post</div>
        <div class="modal-content">
          <textarea id="post-content" rows="3" placeholder="What's happening?"></textarea>
          <button id="post-btn">Post</button>
        </div>
      `, modal => {
        modal.querySelector("#post-btn").onclick = async () => {
          const content = modal.querySelector("#post-content").value.trim();
          if (content) {
            const postData = {
              username: user.username,
              avatar: user.avatar,
              campus: user.campus,
              role: user.role,
              content,
              likes: 0,
              liked: false,
              comments: [],
              time: "now",
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            await db.collection("posts").add(postData);
            loadPosts(); // Fetch new posts from Firestore
            closeModal();
          }
        };
      });
    }

    function promptSignInOrDownload() {
      if (!user) return promptSignIn();
      alert("Download feature coming soon!");
    }

    function showProfile(username) {
      const postUser = demoPosts.find(p => p.username === username) || user || demoUser;
      showModal(`
        <div class="modal-header">${postUser.username}'s Profile</div>
        <div class="modal-content">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
            <div class="avatar">${postUser.avatar}</div>
            <div>
              <div class="username" style="font-size:1.2em;">${postUser.username}</div>
              <div class="badge badge-campus">${postUser.campus}</div>
              <div class="badge ${postUser.role === "leader" ? "badge-leader" : postUser.role === "faculty" ? "badge-faculty" : "badge-student"}">${postUser.role}</div>
            </div>
          </div>
          <div style="margin-bottom:10px;">Bio: <i>Campus enthusiast. More profile features coming soon!</i></div>
          <div style="display:flex;gap:18px;justify-content:center;margin-bottom:10px;">
            <div><b>Posts</b><br>${demoPosts.filter(p=>p.username===postUser.username).length}</div>
            <div><b>Followers</b><br>--</div>
            <div><b>Following</b><br>--</div>
          </div>
          <button onclick="closeModal()">Close</button>
        </div>
      `);
    }

    function showProfileMenu() {
      showModal(`
        <div class="modal-header">Profile Menu</div>
        <div class="modal-content">
          <ul style="list-style:none;padding:0;text-align:left;">
            <li><a href="#" onclick="alert('Following coming soon!');return false;">Following</a></li>
            <li><a href="#" onclick="alert('Followers coming soon!');return false;">Followers</a></li>
            <li><a href="#" onclick="alert('Favorites coming soon!');return false;">Favorites</a></li>
            <li><a href="#" onclick="alert('Saved posts coming soon!');return false;">Saved Posts</a></li>
          </ul>
          <button onclick="closeModal()">Close</button>
        </div>
      `);
    }

    function showMainMenu() {
      showModal(`
        <div class="modal-header">Menu</div>
        <div class="modal-content">
          <ul style="list-style:none;padding:0;text-align:left;">
            <li><a href="#" onclick="alert('Notifications coming soon!');return false;">Notifications</a></li>
            <li><a href="#" onclick="alert('Privacy coming soon!');return false;">Account Privacy</a></li>
            <li><a href="#" onclick="alert('Settings coming soon!');return false;">Settings</a></li>
            <li><a href="#" onclick="alert('Copy profile URL coming soon!');return false;">Copy Profile URL</a></li>
            <li><a href="#" onclick="alert('Share profile coming soon!');return false;">Share Profile</a></li>
          </ul>
          <button onclick="closeModal()">Close</button>
        </div>
      `);
    }

    function showPostMenu(post) {
      showModal(`
        <div class="modal-header">Post Menu</div>
        <div class="modal-content">
          <ul style="list-style:none;padding:0;text-align:left;">
            <li><a href="#" onclick="alert('Add to favorites coming soon!');return false;">Add to Favorites</a></li>
            <li><a href="#" onclick="alert('Get notified coming soon!');return false;">Get Notified</a></li>
            <li><a href="#" onclick="alert('Copy post URL coming soon!');return false;">Copy Post URL</a></li>
            <li><a href="#" onclick="alert('About this account coming soon!');return false;">About this Account</a></li>
            <li><a href="#" onclick="alert('Unfollow coming soon!');return false;">Unfollow</a></li>
            <li><a href="#" onclick="alert('Block coming soon!');return false;">Block</a></li>
            <li><a href="#" onclick="alert('Report coming soon!');return false;">Report</a></li>
          </ul>
          <button onclick="closeModal()">Close</button>
        </div>
      `);
    }

    // Auth Modal (Sign Up / Log In)
    function showAuthModal() {
      let mode = "login";
      render();

      function render(errorMsg = "") {
        showModal(`
          <div class="modal-header" style="text-align:center;">${mode === "login" ? "Log In" : "Sign Up"}</div>
          <div class="modal-content">
            <div class="auth-tabs">
              <button class="auth-tab${mode === "login" ? " active" : ""}" onclick="null">Log In</button>
              <button class="auth-tab${mode === "signup" ? " active" : ""}" onclick="null">Sign Up</button>
            </div>
            ${errorMsg ? `<div style="color:#c00;margin-bottom:8px;">${errorMsg}</div>` : ""}
            <form id="auth-form" autocomplete="off">
              ${mode === "login" ? `
                <input type="text" id="login-username" placeholder="Username or Email" required />
                <input type="password" id="login-password" placeholder="Password" required />
                <button type="submit">Log In</button>
              ` : `
                <input type="text" id="signup-name" placeholder="Official Name" required />
                <input type="text" id="signup-username" placeholder="Preferred Username" required />
                <input type="email" id="signup-email" placeholder="Email" required />
                <input type="text" id="signup-campus" placeholder="Campus" required />
                <input type="text" id="signup-course" placeholder="Course" required />
                <input type="text" id="signup-year" placeholder="Year of Study" required />
                <input type="password" id="signup-password" placeholder="Set Password" required />
                <select id="signup-role">
                  <option value="student">Student</option>
                  <option value="leader">Student Leader</option>
                  <option value="faculty">Faculty</option>
                </select>
                <button type="submit">Sign Up</button>
              `}
            </form>
          </div>
        `, modal => {
          // Tab switching
          const tabs = modal.querySelectorAll('.auth-tab');
          tabs[0].onclick = () => { mode = "login"; render(); };
          tabs[1].onclick = () => { mode = "signup"; render(); };

          // Form handling
          modal.querySelector("#auth-form").onsubmit = async (e) => {
            e.preventDefault();
            if (mode === "login") {
              const emailOrUsername = modal.querySelector("#login-username").value.trim();
              const password = modal.querySelector("#login-password").value;
              try {
                let email = emailOrUsername;
                // If not an email, look up email by username (optional: you can store a username->email map in Firestore)
                if (!emailOrUsername.includes("@")) {
                  // Try to find user by username
                  const snap = await db.collection("users").where("username", "==", emailOrUsername).limit(1).get();
                  if (!snap.empty) {
                    email = snap.docs[0].data().email;
                  } else {
                    render("Username not found.");
                    return;
                  }
                }
                const cred = await auth.signInWithEmailAndPassword(email, password);
                const userDoc = await db.collection("users").doc(cred.user.uid).get();
                user = userDoc.data();
                renderUser();
                renderTab();
                closeModal();
              } catch (err) {
                render(err.message);
              }
            } else {
              // Sign Up
              const name = modal.querySelector("#signup-name").value.trim();
              const username = modal.querySelector("#signup-username").value.trim();
              const email = modal.querySelector("#signup-email").value.trim();
              const campus = modal.querySelector("#signup-campus").value.trim();
              const course = modal.querySelector("#signup-course").value.trim();
              const year = modal.querySelector("#signup-year").value.trim();
              const password = modal.querySelector("#signup-password").value;
              const role = modal.querySelector("#signup-role").value;
              try {
                // Check if username is taken
                const snap = await db.collection("users").where("username", "==", username).limit(1).get();
                if (!snap.empty) {
                  render("Username already taken.");
                  return;
                }
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                const userData = {
                  uid: cred.user.uid,
                  name,
                  username,
                  email,
                  campus,
                  course,
                  year,
                  role,
                  avatar: username[0].toUpperCase()
                };
                await db.collection("users").doc(cred.user.uid).set(userData);
                user = userData;
                renderUser();
                renderTab();
                closeModal();
              } catch (err) {
                render(err.message);
              }
            }
          };
        });
      }
    }

    // Modal helpers
    function showModal(html, onReady) {
      const modalRoot = document.getElementById("modal-root");
      modalRoot.innerHTML = `
        <div class="modal-bg" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            ${html}
          </div>
        </div>
      `;
      if (onReady) onReady(modalRoot.querySelector(".modal"));
    }
    function closeModal(e) {
      if (e && e.target && !e.target.classList.contains("modal-bg")) return;
      document.getElementById("modal-root").innerHTML = "";
    }

    let posts = [];
    async function loadPosts() {
      const snap = await db.collection("posts").orderBy("createdAt", "desc").get();
      posts = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderTab();
    }

    // Call loadPosts() after login/signup and on page load
    document.addEventListener("DOMContentLoaded", () => {
      renderUser();
      loadPosts();
    });
  </script>
</body>
</html>